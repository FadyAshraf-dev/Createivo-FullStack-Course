<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * { box-sizing: border-box; }
        td input { width: 3rem; }
        form input, select {
            width: 100%;
            margin: 0.1rem 0;
        }
        form {
            margin: auto;
            width: 70vw;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }
        table {

            margin: auto;
            width: 70vw;
        }
        td button, td input { width: 100%; }
        td { text-align: center; }
    </style>
</head>

<body>

<form id="form">
    <input type="text" id="name" placeholder="Name">
    <input type="number" id="price" placeholder="Price">
    <input type="number" id="quantity" placeholder="Quantity">

    <select id="category">
        <option value="">--category</option>
        <option value="Phones">Phones</option>
        <option value="TVs">TVs</option>
        <option value="Tablets">Tablets</option>
    </select>

    <select id="brand">
        <option value="">--brand</option>
        <option value="Apple">Apple</option>
        <option value="Samsung">Samsung</option>
        <option value="LG">LG</option>
    </select>

    <button id="add" type="button">Add Item</button>
    <input type="text" id="search" placeholder="Search?">
</form>

<table border="1">
    <thead>
        <tr>
            <th>Item</th><th>Price</th><th>Qty</th>
            <th>Category</th><th>Brand</th>
            <th>Remove</th><th>Edit</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    const nameEl = document.querySelector("#name");
    const priceEl = document.querySelector("#price");
    const qtyEl = document.querySelector("#quantity");
    const categoryEl = document.querySelector("#category");
    const brandEl = document.querySelector("#brand");
    const searchEl = document.querySelector("#search");
    const tbody = document.querySelector("tbody");
    const addBtn = document.querySelector("#add");

    let data = JSON.parse(localStorage.getItem("data")) || [];

    /* ------------------------- Helpers ------------------------- */

    const createInput = (value, type = "text") =>
        Object.assign(document.createElement("input"), { value, type });

    const createBtn = (label, cls) =>
        Object.assign(document.createElement("button"), {
            textContent: label,
            className: cls
        });

    const save = () =>
        localStorage.setItem("data", JSON.stringify(data));

    const resetForm = () => {
        nameEl.value = "";
        priceEl.value = "";
        qtyEl.value = "";
        categoryEl.value = "";
        brandEl.value = "";
        categoryEl.firstElementChild.style.display = "block";
        brandEl.firstElementChild.style.display = "block";
    };

    const replaceEditWithCanfirm = (row, confirmBtn, cancelBtn)=>{
        row.children[6].innerHTML = "";
        row.children[6].append(confirmBtn, cancelBtn);

    }

    const replaceTableCellsWithInputs = (row, field, i)=>{
        row.children[i].innerHTML = "";
        row.children[i].appendChild(field);

    }

    /* ------------------------- Rendering ------------------------- */

    function renderTable(list = data) {
        tbody.innerHTML = "";

        list.forEach((item, index) => addRow(index, item));

        tbody.insertAdjacentHTML(
            "beforeend",
            `<tfoot>
                <tr><td colspan="7" style="text-align:center">
                    Total is ${list.reduce((a, o) => a + Number(o.price), 0)}$
                </td></tr>
            </tfoot>`
        );
    }

    function addRow(index, item) {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${item.name}</td>
            <td>${item.price}</td>
            <td>${item.quantity}</td>
            <td>${item.category}</td>
            <td>${item.brand}</td>
            <td><button class="remove">Remove</button></td>
            <td><button class="edit">Edit</button></td>
        `;

        row.querySelector(".remove").onclick = () => {
            data.splice(index, 1);
            save();
            renderTable();
        };

        row.querySelector(".edit").onclick = () => enterEditMode(row, index);

        tbody.appendChild(row);
    }

    /* ------------------------- Edit Mode ------------------------- */

    function enterEditMode(row, index) {
        const original = data[index];

        // Create Inputs (short & clean)
        const nameInput     = Object.assign(document.createElement("input"), { value: original.name });
        const priceInput    = Object.assign(document.createElement("input"), { value: original.price, type: "number" });
        const qtyInput      = Object.assign(document.createElement("input"), { value: original.quantity, type: "number" });

        // Clone selects
        const categorySelect = categoryEl.cloneNode(true);
        const brandSelect    = brandEl.cloneNode(true);

        // Assigning select values + hiding first option
        [[categorySelect, original.category], [brandSelect, original.brand]].forEach(([select, val]) => {
            Object.assign(select, { value: val });
            Object.assign(select.firstElementChild.style, { display: "none" });
        });

        // Combine all editable fields
        const fields = [nameInput, priceInput, qtyInput, categorySelect, brandSelect];

        // Replace table cells with the new inputs/selects
        fields.forEach((field, i) => {
            replaceTableCellsWithInputs(row, field, i)
        });

        // Buttons
        const confirmBtn = Object.assign(document.createElement("button"), { textContent: "Confirm", className: "confirm" });
        const cancelBtn  = Object.assign(document.createElement("button"), { textContent: "Cancel", className: "cancel" });

        replaceEditWithCanfirm(row, confirmBtn, cancelBtn)
        // Cancel Action
        cancelBtn.onclick = () => renderTable();

        // Confirm Action
        confirmBtn.onclick = () => {
            if (!nameInput.value || !priceInput.value || !qtyInput.value ||
                !categorySelect.value || !brandSelect.value) return;

            data[index] = {
                name: nameInput.value,
                price: priceInput.value,
                quantity: qtyInput.value,
                category: categorySelect.value,
                brand: brandSelect.value
            };
            
            save();
            renderTable();
        };
    }
    /* ------------------------- Events ------------------------- */

    addBtn.onclick = () => {
        if (!nameEl.value || !priceEl.value || !qtyEl.value ||
            !categoryEl.value || !brandEl.value) return;

        data.push({
            name: nameEl.value,
            price: priceEl.value,
            quantity: qtyEl.value,
            category: categoryEl.value,
            brand: brandEl.value
        });

        save();
        renderTable();
        resetForm();
    };

    searchEl.onkeyup = () => {
        const q = searchEl.value.toLowerCase();
        renderTable(data.filter(item =>
            item.name.toLowerCase().includes(q)
        ));
    };

    categoryEl.onchange = () => categoryEl.firstElementChild.style.display = "none";
    brandEl.onchange = () => brandEl.firstElementChild.style.display = "none";

    /* ------------------------- Initalise ------------------------- */
    renderTable();
</script>

</body>
</html>
