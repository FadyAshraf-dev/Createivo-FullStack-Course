<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        *{
            box-sizing: border-box;
        }
        td input
        {
            width: 3rem;
        }
        form input, select{
            width: 100%;
            margin: 0.1rem 0rem;
        }
        form {
            margin: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 70vw;
            flex-wrap: wrap;
            
        }
        table {
            margin: auto;
            width: 70vw;
            flex-wrap: wrap;
            
        }
        td button,td input{
            width:100%;
        }
        td{
            text-align: center;
        }
    </style>
</head>
<body>
    <form action="">
    <input type="text" id="name" placeholder="Name">
    <input type="number" id="price" placeholder="Price">
    <input type="number" id="quantity" placeholder="Quantity">
    <select id="category" >
        <option value="">--category</option>
        <option value="Phones">Phones</option>
        <option value="TVs">TVs</option>
        <option value="Tablets">Tablets</option>
    </select>
    <select id="brand">
        <option value="">--brand</option>
        <option value="Apple">Apple</option>
        <option value="Samsung">Samsung</option>
        <option value="LG">LG</option>
    </select>
    <button id="add">Add Item</button>
    <input type="text" name="search" id="search" placeholder="Search?">
    </form>
<table border="1">
    <thead>
        <tr>
            <th>Item</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Category</th>
            <th>Brand</th>
            <th>Remove</th>
            <th>Edit</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
    </table>
    <script>
        let name = document.querySelector("#name")
        let price = document.querySelector("#price")
        let quantity = document.querySelector("#quantity")
        let category = document.querySelector("#category")
        let brand = document.querySelector("#brand")
        let tbody=document.querySelector("tbody")
        let btnAdd = document.querySelector("#add")
        let search = document.querySelector("#search")

        category.addEventListener("change", ()=>{
            category.firstElementChild.style.display = "none"
        })
        brand.addEventListener("change", ()=>{
            brand.firstElementChild.style.display = "none"
        })
        search.addEventListener("keyup", ()=>{
            renderTable(data.filter((obj)=>{return obj.name.toLowerCase().includes(search.value.toLowerCase())}))
        })
        let data = JSON.parse(window.localStorage.getItem("data"))||[]
        // let names = JSON.parse(window.localStorage.getItem("names"))||[]
        // let emails = JSON.parse(window.localStorage.getItem("emails"))||[]
        // let phones = JSON.parse(window.localStorage.getItem("phones"))||[]


        function createInput(value, type="text") {
            const input = document.createElement("input")
            input.type = type
            input.value = value
            return input
        }

        

        function createBtn(text, className) {
            const btn = document.createElement("button")
            btn.textContent = text
            btn.classList.add(className)
            return btn
        }




        function addRow(index, obj) {
            const row = document.createElement("tr")

            row.innerHTML = `
                <td>${obj.name}</td>
                <td>${obj.price}</td>
                <td>${obj.quantity}</td>
                <td>${obj.category}</td>
                <td>${obj.brand}</td>
                <td><button class="remove">Remove</button></td>
                <td><button class="edit">edit</button></td>
            `;
            row.querySelector(".remove").addEventListener("click" ,()=>{
                // names.splice(index,1)
                // emails.splice(index,1)
                // phones.splice(index,1)
                data.splice(index, 1)
                saveData()
                renderTable()
            })

            row.querySelector(".edit").addEventListener("click" ,()=>{
                const nameInput = createInput(data[index].name)
                const priceInput = createInput(data[index].price, "number")
                const quantityInput = createInput(data[index].quantity, "number")


                const categorySelect = category.cloneNode(true)
                const brandSelect = brand.cloneNode(true)

                categorySelect.firstElementChild.style.display = "none"
                brandSelect.firstElementChild.style.display = "none"


                categorySelect.value = data[index].category
                brandSelect.value = data[index].brand



                const confirmBtn = createBtn("confirm", "confirm")
                const cancelBtn = createBtn("cancel", "cancel")

                const inputs = [nameInput, priceInput, quantityInput, categorySelect, brandSelect]


                //replace three td with three inputs
                inputs.forEach((input, i) => {
                    row.children[i].innerHTML = ""
                    row.children[i].appendChild(input)
                })


                //replacee edit with confirm and cancel button
                row.children[6].innerHTML = ""
                row.children[6].append(confirmBtn, cancelBtn)

                row.querySelector(".cancel").addEventListener("click", ()=>{
                    renderTable()
                })
                
                row.querySelector(".confirm").addEventListener("click", ()=>{
                    // names[index] = nameInput.value
                    // emails[index] = emailInput.value
                    // phones[index] = phoneInput.value
                    
                    if(!nameInput.value || !priceInput.value || !quantityInput.value || !categorySelect.value||!brandSelect.value)return;
                    data[index] = {
                        name:nameInput.value,
                        price:priceInput.value,
                        quantity:quantityInput.value,
                        category:categorySelect.value,
                        brand:brandSelect.value
                    }
                    saveData()
                    renderTable()
                })

                 
            }
        )
            tbody.appendChild(row)
        }

        function saveData() {
            // window.localStorage.setItem("names", JSON.stringify(names))
            // window.localStorage.setItem("emails", JSON.stringify(emails))
            // window.localStorage.setItem("phones", JSON.stringify(phones))
            window.localStorage.setItem("data", JSON.stringify(data))
        }


        function renderTable(newData = data) {
            tbody.innerHTML = ""
            newData.forEach((obj, i) => {
                addRow(i,obj)
            });
            const tfoot =
            `<tfoot>
                <tr style="text-align:center">
                    <td colspan="7">Total is ${newData.reduce((acc, obj)=>{return acc+Number(obj.price)}, 0)}$</td>
                </tr>
            </tfoot>`
            tbody.insertAdjacentHTML("beforeend", tfoot)
        }
        btnAdd.addEventListener("click", ()=>{
            if(!name.value || !price.value || !quantity.value|| !category.value || !brand.value)return;
            // names.push(name.value)
            // emails.push(email.value)
            // phones.push(phone.value)
            data.push({
                name:name.value,
                price:price.value,
                quantity:quantity.value,
                category:category.value,
                brand:brand.value
            })
            saveData()
            renderTable()
            name.value=""
            price.value=""
            quantity.value=""
            
            category.firstElementChild.style.display = "block"
            brand.firstElementChild.style.display = "block"

            category.value=""
            brand.value=""
        })
        renderTable()
    </script>
</body>
</html>